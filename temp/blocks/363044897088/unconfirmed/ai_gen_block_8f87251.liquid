{% doc %}
  @prompt
    Left side: three icons + labels — Exercise, Diet, NAD Boosters.
    
    Center: highlighted “NAD⁺” bubble.
    
    Around it: ten evenly spaced bubbles for each organ/system.
    
    Hover → short tooltip; click → full explanation (modal or accordion).
    
    Thin lines connect every bubble to the NAD⁺ center.
    
    Use existing theme fonts and colors; allow simple color overrides if needed., Fluxogram: Left side: three icons + labels — Exercise, Diet, NAD Boosters.
    
    Center: highlighted “NAD⁺” bubble.
    
    Around it: ten evenly spaced bubbles for each organ/system.
    
    Hover → short tooltip; click → full explanation (modal or accordion).
    
    Thin lines connect every bubble to the NAD⁺ center.
    
    Use existing theme fonts and colors; allow simple color overrides if needed.
    

{% enddoc %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-nad-fluxogram-{{ ai_gen_id }} {
    padding: 40px 20px;
    background-color: {{ block.settings.background_color }};
    border-radius: {{ block.settings.border_radius }}px;
    font-family: var(--font-body-family);
  }

  .ai-nad-fluxogram__container-{{ ai_gen_id }} {
    display: flex;
    gap: 40px;
    align-items: flex-start;
    max-width: 1200px;
    margin: 0 auto;
  }

  .ai-nad-fluxogram__left-panel-{{ ai_gen_id }} {
    flex: 0 0 220px;
    display: flex;
    flex-direction: column;
    gap: 24px;
  }

  .ai-nad-fluxogram__factor-item-{{ ai_gen_id }} {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 18px;
    background-color: {{ block.settings.factor_background_color }};
    border-radius: {{ block.settings.factor_border_radius }}px;
    color: {{ block.settings.text_color }};
    font-size: {{ block.settings.factor_text_size }}px;
    font-weight: 500;
    transition: all 0.3s ease;
    border: 2px solid transparent;
  }

  .ai-nad-fluxogram__factor-item-{{ ai_gen_id }}:hover {
    transform: translateY(-2px);
    border-color: {{ block.settings.factor_hover_border }};
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }

  .ai-nad-fluxogram__factor-icon-{{ ai_gen_id }} {
    width: 28px;
    height: 28px;
    flex-shrink: 0;
    color: {{ block.settings.factor_icon_color }};
  }

  .ai-nad-fluxogram__center-panel-{{ ai_gen_id }} {
    flex: 1;
    position: relative;
    min-height: 600px;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .ai-nad-fluxogram__svg-container-{{ ai_gen_id }} {
    position: relative;
    width: 100%;
    height: 600px;
  }

  .ai-nad-fluxogram__svg-{{ ai_gen_id }} {
    width: 100%;
    height: 100%;
  }

  .ai-nad-fluxogram__center-bubble-{{ ai_gen_id }} {
    fill: {{ block.settings.center_bubble_color }};
    stroke: {{ block.settings.center_bubble_border }};
    stroke-width: 4;
    filter: drop-shadow(0 6px 12px rgba(0, 0, 0, 0.15));
  }

  .ai-nad-fluxogram__organ-bubble-{{ ai_gen_id }} {
    fill: {{ block.settings.organ_bubble_color }};
    stroke: {{ block.settings.organ_bubble_border }};
    stroke-width: 2;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .ai-nad-fluxogram__organ-bubble-{{ ai_gen_id }}:hover {
    fill: {{ block.settings.organ_bubble_hover_color }};
    stroke-width: 3;
    filter: drop-shadow(0 3px 6px rgba(0, 0, 0, 0.2));
    transform: scale(1.05);
  }

  .ai-nad-fluxogram__connection-line-{{ ai_gen_id }} {
    stroke: {{ block.settings.connection_line_color }};
    stroke-width: {{ block.settings.connection_line_width }};
    opacity: {{ block.settings.connection_line_opacity | divided_by: 100.0 }};
    stroke-dasharray: {{ block.settings.line_style }};
  }

  .ai-nad-fluxogram__bubble-text-{{ ai_gen_id }} {
    fill: {{ block.settings.bubble_text_color }};
    font-family: var(--font-body-family);
    font-size: 13px;
    font-weight: 600;
    text-anchor: middle;
    dominant-baseline: central;
    pointer-events: none;
  }

  .ai-nad-fluxogram__center-text-{{ ai_gen_id }} {
    font-size: 20px;
    font-weight: 700;
    fill: {{ block.settings.center_text_color }};
  }

  .ai-nad-fluxogram__tooltip-{{ ai_gen_id }} {
    position: absolute;
    background-color: {{ block.settings.tooltip_background }};
    color: {{ block.settings.tooltip_text_color }};
    padding: 10px 14px;
    border-radius: 8px;
    font-size: 13px;
    white-space: nowrap;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.3s ease;
    z-index: 10;
    max-width: 200px;
    white-space: normal;
    text-align: center;
  }

  .ai-nad-fluxogram__tooltip-{{ ai_gen_id }}.active {
    opacity: 1;
  }

  .ai-nad-fluxogram__modal-{{ ai_gen_id }} {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.6);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
  }

  .ai-nad-fluxogram__modal-{{ ai_gen_id }}.active {
    opacity: 1;
    visibility: visible;
  }

  .ai-nad-fluxogram__modal-content-{{ ai_gen_id }} {
    background-color: {{ block.settings.modal_background }};
    color: {{ block.settings.modal_text_color }};
    padding: 40px;
    border-radius: {{ block.settings.modal_border_radius }}px;
    max-width: 600px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
    position: relative;
    transform: scale(0.9);
    transition: transform 0.3s ease;
  }

  .ai-nad-fluxogram__modal-{{ ai_gen_id }}.active .ai-nad-fluxogram__modal-content-{{ ai_gen_id }} {
    transform: scale(1);
  }

  .ai-nad-fluxogram__modal-title-{{ ai_gen_id }} {
    font-size: 28px;
    font-weight: 700;
    margin: 0 0 20px;
    color: {{ block.settings.modal_title_color }};
    font-family: var(--font-heading-family);
  }

  .ai-nad-fluxogram__modal-description-{{ ai_gen_id }} {
    font-size: 16px;
    line-height: 1.6;
    margin: 0;
  }

  .ai-nad-fluxogram__modal-close-{{ ai_gen_id }} {
    position: absolute;
    top: 20px;
    right: 20px;
    background: none;
    border: none;
    font-size: 28px;
    cursor: pointer;
    color: {{ block.settings.modal_text_color }};
    opacity: 0.7;
    transition: opacity 0.2s ease;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .ai-nad-fluxogram__modal-close-{{ ai_gen_id }}:hover {
    opacity: 1;
  }

  @media screen and (max-width: 768px) {
    .ai-nad-fluxogram__container-{{ ai_gen_id }} {
      flex-direction: column;
      gap: 30px;
    }

    .ai-nad-fluxogram__left-panel-{{ ai_gen_id }} {
      flex: none;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
    }

    .ai-nad-fluxogram__factor-item-{{ ai_gen_id }} {
      flex-direction: column;
      text-align: center;
      padding: 16px 12px;
      font-size: 12px;
    }

    .ai-nad-fluxogram__factor-icon-{{ ai_gen_id }} {
      width: 24px;
      height: 24px;
    }

    .ai-nad-fluxogram__svg-container-{{ ai_gen_id }} {
      height: 450px;
    }

    .ai-nad-fluxogram__bubble-text-{{ ai_gen_id }} {
      font-size: 10px;
    }

    .ai-nad-fluxogram__center-text-{{ ai_gen_id }} {
      font-size: 16px;
    }

    .ai-nad-fluxogram__modal-content-{{ ai_gen_id }} {
      padding: 30px 20px;
    }

    .ai-nad-fluxogram__modal-title-{{ ai_gen_id }} {
      font-size: 24px;
    }
  }
{% endstyle %}

<nad-fluxogram-{{ ai_gen_id }} class="ai-nad-fluxogram-{{ ai_gen_id }}" {{ block.shopify_attributes }}>
  <div class="ai-nad-fluxogram__container-{{ ai_gen_id }}">
    <div class="ai-nad-fluxogram__left-panel-{{ ai_gen_id }}">
      <div class="ai-nad-fluxogram__factor-item-{{ ai_gen_id }}">
        <svg class="ai-nad-fluxogram__factor-icon-{{ ai_gen_id }}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M6 2v6h.01L6 8.01 10 8l4-4V2"/>
          <path d="M6 8.01L2 12l4 4 4-4 4 4 4-4-4-4"/>
          <path d="M18 22V16h-.01L18 15.99 14 16l-4 4v2"/>
        </svg>
        <span>{{ block.settings.exercise_label }}</span>
      </div>
      
      <div class="ai-nad-fluxogram__factor-item-{{ ai_gen_id }}">
        <svg class="ai-nad-fluxogram__factor-icon-{{ ai_gen_id }}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M18 8h1a4 4 0 0 1 0 8h-1"/>
          <path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"/>
          <line x1="6" y1="1" x2="6" y2="4"/>
          <line x1="10" y1="1" x2="10" y2="4"/>
          <line x1="14" y1="1" x2="14" y2="4"/>
        </svg>
        <span>{{ block.settings.diet_label }}</span>
      </div>
      
      <div class="ai-nad-fluxogram__factor-item-{{ ai_gen_id }}">
        <svg class="ai-nad-fluxogram__factor-icon-{{ ai_gen_id }}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
          <circle cx="12" cy="5" r="2"/>
          <path d="M12 7v4"/>
          <line x1="8" y1="16" x2="16" y2="16"/>
          <line x1="10" y1="19" x2="14" y2="19"/>
        </svg>
        <span>{{ block.settings.nad_boosters_label }}</span>
      </div>
    </div>

    <div class="ai-nad-fluxogram__center-panel-{{ ai_gen_id }}">
      <svg class="ai-nad-fluxogram__svg-{{ ai_gen_id }}" viewBox="0 0 500 500">
        <defs>
          <filter id="glow-{{ ai_gen_id }}">
            <feGaussianBlur stdDeviation="4" result="coloredBlur"/>
            <feMerge>
              <feMergeNode in="coloredBlur"/>
              <feMergeNode in="SourceGraphic"/>
            </feMerge>
          </filter>
        </defs>

        {% assign organs = "Brain,Heart,Liver,Kidneys,Muscles,Skin,Eyes,Lungs,Immune,Metabolism" | split: "," %}
        {% assign tooltips = "Cognitive enhancement & neuroprotection|Cardiovascular health & energy|Liver detox & regeneration|Kidney function & filtration|Muscle strength & endurance|Anti-aging & skin health|Vision protection & eye health|Respiratory function & oxygen|Immune system boost|Metabolic optimization" | split: "|" %}
        {% assign descriptions = "NAD⁺ plays a crucial role in brain health by supporting mitochondrial function, enhancing cognitive performance, protecting against neurodegenerative diseases, and promoting neuroplasticity. It helps maintain mental clarity, memory formation, and overall brain energy metabolism.|NAD⁺ is essential for heart health, supporting cardiac muscle function, improving circulation, and maintaining healthy blood pressure. It enhances cellular energy production in heart tissue and helps protect against cardiovascular aging and oxidative stress.|The liver relies heavily on NAD⁺ for detoxification processes, fat metabolism, and cellular repair. NAD⁺ supports liver regeneration, helps process toxins more efficiently, and maintains optimal liver function for overall metabolic health.|NAD⁺ supports kidney function by enhancing cellular energy production, promoting healthy filtration, and protecting against oxidative damage. It helps maintain proper fluid balance and supports the kidneys' vital role in waste elimination.|Muscle tissue depends on NAD⁺ for energy production, protein synthesis, and recovery. Higher NAD⁺ levels support muscle strength, endurance, and faster recovery from exercise while helping prevent age-related muscle loss.|NAD⁺ is vital for skin health, supporting collagen production, DNA repair, and protection against UV damage. It helps maintain skin elasticity, reduces signs of aging, and promotes healthy skin cell turnover and regeneration.|NAD⁺ protects eye health by supporting retinal function, preventing oxidative damage, and maintaining healthy vision. It helps protect against age-related eye conditions and supports overall ocular health and visual acuity.|NAD⁺ supports respiratory health by enhancing lung tissue function, improving oxygen utilization, and protecting against oxidative stress. It helps maintain healthy breathing patterns and supports overall respiratory efficiency.|The immune system relies on NAD⁺ for proper immune cell function, inflammatory response regulation, and pathogen defense. NAD⁺ helps maintain immune system balance and supports the body's natural defense mechanisms.|NAD⁺ is central to metabolic processes, supporting efficient energy production, glucose metabolism, and fat burning. It helps regulate metabolic pathways, supports healthy weight management, and optimizes overall metabolic function." | split: "|" %}
        
        {% for organ in organs %}
          {% assign angle = forloop.index0 | times: 36 %}
          {% assign radian = angle | times: 3.14159 | divided_by: 180 %}
          {% assign x = 250 | plus: 150 | times: radian | cos %}
          {% assign y = 250 | plus: 150 | times: radian | sin %}
          
          <line
            class="ai-nad-fluxogram__connection-line-{{ ai_gen_id }}"
            x1="250" 
            y1="250" 
            x2="{{ x }}" 
            y2="{{ y }}"
          />
        {% endfor %}

        {% for organ in organs %}
          {% assign angle = forloop.index0 | times: 36 %}
          {% assign radian = angle | times: 3.14159 | divided_by: 180 %}
          {% assign x = 250 | plus: 150 | times: radian | cos %}
          {% assign y = 250 | plus: 150 | times: radian | sin %}
          
          <circle 
            class="ai-nad-fluxogram__organ-bubble-{{ ai_gen_id }}"
            cx="{{ x }}" 
            cy="{{ y }}" 
            r="35"
            data-organ="{{ organ }}"
            data-description="{{ descriptions[forloop.index0] }}"
            data-tooltip="{{ tooltips[forloop.index0] }}"
          />
          
          <text 
            class="ai-nad-fluxogram__bubble-text-{{ ai_gen_id }}"
            x="{{ x }}" 
            y="{{ y }}">
            {{ organ }}
          </text>
        {% endfor %}

        <circle 
          class="ai-nad-fluxogram__center-bubble-{{ ai_gen_id }}"
          cx="250" 
          cy="250" 
          r="50"
          filter="url(#glow-{{ ai_gen_id }})"
        />
        <text 
          class="ai-nad-fluxogram__bubble-text-{{ ai_gen_id }} ai-nad-fluxogram__center-text-{{ ai_gen_id }}"
          x="250" 
          y="250">
          NAD⁺
        </text>
      </svg>

      <div class="ai-nad-fluxogram__tooltip-{{ ai_gen_id }}"></div>
    </div>
  </div>

  <div class="ai-nad-fluxogram__modal-{{ ai_gen_id }}">
    <div class="ai-nad-fluxogram__modal-content-{{ ai_gen_id }}">
      <button class="ai-nad-fluxogram__modal-close-{{ ai_gen_id }}" aria-label="Close modal">&times;</button>
      <h3 class="ai-nad-fluxogram__modal-title-{{ ai_gen_id }}"></h3>
      <p class="ai-nad-fluxogram__modal-description-{{ ai_gen_id }}"></p>
    </div>
  </div>
</nad-fluxogram-{{ ai_gen_id }}>

<script>
  (function() {
    class NadFluxogram{{ ai_gen_id }} extends HTMLElement {
      constructor() {
        super();
        this.tooltip = null;
        this.modal = null;
        this.modalTitle = null;
        this.modalDescription = null;
        this.modalClose = null;
      }

      connectedCallback() {
        this.tooltip = this.querySelector('.ai-nad-fluxogram__tooltip-{{ ai_gen_id }}');
        this.modal = this.querySelector('.ai-nad-fluxogram__modal-{{ ai_gen_id }}');
        this.modalTitle = this.querySelector('.ai-nad-fluxogram__modal-title-{{ ai_gen_id }}');
        this.modalDescription = this.querySelector('.ai-nad-fluxogram__modal-description-{{ ai_gen_id }}');
        this.modalClose = this.querySelector('.ai-nad-fluxogram__modal-close-{{ ai_gen_id }}');
        
        this.setupEventListeners();
      }

      setupEventListeners() {
        const organBubbles = this.querySelectorAll('.ai-nad-fluxogram__organ-bubble-{{ ai_gen_id }}');
        
        organBubbles.forEach(bubble => {
          bubble.addEventListener('mouseenter', (e) => this.showTooltip(e));
          bubble.addEventListener('mouseleave', () => this.hideTooltip());
          bubble.addEventListener('mousemove', (e) => this.updateTooltipPosition(e));
          bubble.addEventListener('click', (e) => this.showModal(e));
        });

        this.modalClose.addEventListener('click', () => this.hideModal());
        
        this.modal.addEventListener('click', (e) => {
          if (e.target === this.modal) {
            this.hideModal();
          }
        });

        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape' && this.modal.classList.contains('active')) {
            this.hideModal();
          }
        });
      }

      showTooltip(event) {
        const tooltipText = event.target.dataset.tooltip;
        this.tooltip.textContent = tooltipText;
        this.tooltip.classList.add('active');
        this.updateTooltipPosition(event);
      }

      hideTooltip() {
        this.tooltip.classList.remove('active');
      }

      updateTooltipPosition(event) {
        const rect = this.getBoundingClientRect();
        const tooltipRect = this.tooltip.getBoundingClientRect();
        let x = event.clientX - rect.left + 15;
        let y = event.clientY - rect.top - 15;
        
        if (x + tooltipRect.width > rect.width) {
          x = event.clientX - rect.left - tooltipRect.width - 15;
        }
        
        if (y < 0) {
          y = event.clientY - rect.top + 15;
        }
        
        this.tooltip.style.left = x + 'px';
        this.tooltip.style.top = y + 'px';
      }

      showModal(event) {
        const organ = event.target.dataset.organ;
        const description = event.target.dataset.description;
        
        this.modalTitle.textContent = `NAD⁺ and ${organ}`;
        this.modalDescription.textContent = description;
        this.modal.classList.add('active');
        document.body.style.overflow = 'hidden';
      }

      hideModal() {
        this.modal.classList.remove('active');
        document.body.style.overflow = '';
      }
    }

    customElements.define('nad-fluxogram-{{ ai_gen_id }}', NadFluxogram{{ ai_gen_id }});
  })();
</script>

{% schema %}
{
  "name": "NAD⁺ Benefits Fluxogram",
  "tag": null,
  "settings": [
    {
      "type": "header",
      "content": "Factor Labels"
    },
    {
      "type": "text",
      "id": "exercise_label",
      "label": "Exercise label",
      "default": "Exercise"
    },
    {
      "type": "text",
      "id": "diet_label",
      "label": "Diet label",
      "default": "Diet"
    },
    {
      "type": "text",
      "id": "nad_boosters_label",
      "label": "NAD Boosters label",
      "default": "NAD Boosters"
    },
    {
      "type": "header",
      "content": "Main Colors"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text color",
      "default": "#000000"
    },
    {
      "type": "header",
      "content": "Factor Panel"
    },
    {
      "type": "color",
      "id": "factor_icon_color",
      "label": "Factor icon color",
      "default": "#334fb4"
    },
    {
      "type": "color",
      "id": "factor_background_color",
      "label": "Factor background color",
      "default": "#f7f5eb"
    },
    {
      "type": "color",
      "id": "factor_hover_border",
      "label": "Factor hover border",
      "default": "#334fb4"
    },
    {
      "type": "range",
      "id": "factor_text_size",
      "min": 12,
      "max": 18,
      "step": 1,
      "unit": "px",
      "label": "Factor text size",
      "default": 14
    },
    {
      "type": "range",
      "id": "factor_border_radius",
      "min": 0,
      "max": 20,
      "step": 2,
      "unit": "px",
      "label": "Factor border radius",
      "default": 12
    },
    {
      "type": "header",
      "content": "NAD⁺ Center Bubble"
    },
    {
      "type": "color",
      "id": "center_bubble_color",
      "label": "NAD⁺ bubble color",
      "default": "#334fb4"
    },
    {
      "type": "color",
      "id": "center_bubble_border",
      "label": "NAD⁺ bubble border",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "center_text_color",
      "label": "NAD⁺ text color",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "Organ Bubbles"
    },
    {
      "type": "color",
      "id": "organ_bubble_color",
      "label": "Organ bubble color",
      "default": "#e5dbcc"
    },
    {
      "type": "color",
      "id": "organ_bubble_border",
      "label": "Organ bubble border",
      "default": "#334fb4"
    },
    {
      "type": "color",
      "id": "organ_bubble_hover_color",
      "label": "Organ bubble hover color",
      "default": "#334fb4"
    },
    {
      "type": "color",
      "id": "bubble_text_color",
      "label": "Bubble text color",
      "default": "#000000"
    },
    {
      "type": "header",
      "content": "Connection Lines"
    },
    {
      "type": "color",
      "id": "connection_line_color",
      "label": "Connection line color",
      "default": "#334fb4"
    },
    {
      "type": "range",
      "id": "connection_line_width",
      "min": 1,
      "max": 4,
      "step": 1,
      "unit": "px",
      "label": "Line width",
      "default": 2
    },
    {
      "type": "range",
      "id": "connection_line_opacity",
      "min": 20,
      "max": 100,
      "step": 10,
      "unit": "%",
      "label": "Line opacity",
      "default": 70
    },
    {
      "type": "select",
      "id": "line_style",
      "label": "Line style",
      "options": [
        {
          "value": "none",
          "label": "Solid"
        },
        {
          "value": "5,5",
          "label": "Dashed"
        },
        {
          "value": "2,3",
          "label": "Dotted"
        }
      ],
      "default": "none"
    },
    {
      "type": "header",
      "content": "Tooltip"
    },
    {
      "type": "color",
      "id": "tooltip_background",
      "label": "Tooltip background",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "tooltip_text_color",
      "label": "Tooltip text color",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "Modal"
    },
    {
      "type": "color",
      "id": "modal_background",
      "label": "Modal background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "modal_text_color",
      "label": "Modal text color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "modal_title_color",
      "label": "Modal title color",
      "default": "#334fb4"
    },
    {
      "type": "range",
      "id": "modal_border_radius",
      "min": 0,
      "max": 30,
      "step": 2,
      "unit": "px",
      "label": "Modal border radius",
      "default": 16
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "range",
      "id": "border_radius",
      "min": 0,
      "max": 40,
      "step": 2,
      "unit": "px",
      "label": "Container border radius",
      "default": 16
    }
  ],
  "presets": [
    {
      "name": "NAD⁺ Benefits Fluxogram"
    }
  ]
}
{% endschema %}